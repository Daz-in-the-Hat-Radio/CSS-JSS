(function() {
  const apiUrl = "http://localhost:3000/news"; // Your backend proxy URL

  async function fetchNews() {
    try {
      const res = await fetch(apiUrl);
      const data = await res.json();
      return data.articles || [];
    } catch (e) {
      console.error("Failed to fetch news:", e);
      return [];
    }
  }

  function createSlide(article) {
    const slide = document.createElement('div');
    slide.className = 'slide';

    const img = document.createElement('img');
    img.src = article.image || 'https://via.placeholder.com/425x200?text=No+Image';
    slide.appendChild(img);

    const title = document.createElement('h3');
    title.textContent = article.title;
    slide.appendChild(title);

    const desc = document.createElement('p');
    desc.textContent = article.description || '';
    slide.appendChild(desc);

    const link = document.createElement('a');
    link.href = article.url;
    link.target = '_blank';
    link.textContent = "Read more";
    slide.appendChild(link);

    return slide;
  }

  async function initCarousel() {
    const articles = await fetchNews();
    const carousel = document.getElementById('carousel');

    if (!carousel) {
      console.error("Carousel container not found");
      return;
    }

    if (articles.length === 0) {
      carousel.innerHTML = "<p style='padding:10px'>No articles available.</p>";
      return;
    }

    articles.forEach(article => {
      carousel.appendChild(createSlide(article));
    });

    let index = 0;
    const maxIndex = articles.length - 1;

    function showSlide(newIndex) {
      index = newIndex;
      carousel.style.transform = `translateX(-${index * 100}%)`;
    }

    document.getElementById('prev-btn').onclick = () => {
      showSlide(index > 0 ? index - 1 : maxIndex);
    };

    document.getElementById('next-btn').onclick = () => {
      showSlide(index < maxIndex ? index + 1 : 0);
    };

    // âœ… Auto-scroll every 5 seconds
    setInterval(() => {
      showSlide(index < maxIndex ? index + 1 : 0);
    }, 5000);
  }

  // Initialize once DOM is ready
  document.addEventListener('DOMContentLoaded', initCarousel);
})();
